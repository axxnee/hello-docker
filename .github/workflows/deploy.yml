name: CI-CD-to-Home-PC

on:
  push:
    branches: [ main ]

jobs:
  deploy:
    runs-on: self-hosted  # 내 PC(WSL2) 러너 지정

    steps:
      - name: 코드 체크아웃
        uses: actions/checkout@v4

      - name: 기존 컨테이너 정리
        # 이름이 hello-docker인 컨테이너가 있으면 끄고 삭제합니다.
        run: |
          docker stop hello-docker || true
          docker rm hello-docker || true

      - name: Docker 이미지 빌드
        # 현재 폴더의 Dockerfile을 기반으로 hello-docker라는 이름의 이미지를 만듭니다.
        run: docker build -t hello-docker .

      - name: Docker 컨테이너 실행
        # -d: 백그라운드 실행
        # -p 3000:3000: 호스트 포트 3000번과 컨테이너 3000번 연결
        # --name: 컨테이너 이름을 hello-docker로 고정
        run: docker run -d -p 3000:3000 --name hello-docker hello-docker

      - name: 배포 상태 확인
        run: |
          sleep 2
          curl http://localhost:3000